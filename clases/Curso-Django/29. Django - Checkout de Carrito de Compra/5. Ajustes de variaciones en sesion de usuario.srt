1
00:00:00,360 --> 00:00:05,760
En el capítulo anterior hicimos los ajustes para que me pudieran aparecer los elementos dentro del carrito

2
00:00:05,760 --> 00:00:11,880
de compras cuando yo iniciaba sesión y actualmente estoy en una sesión de store flaccidez.

3
00:00:12,090 --> 00:00:13,560
Pero aquí tengo un pequeño problema.

4
00:00:13,950 --> 00:00:14,580
Voy a mostrarte.

5
00:00:14,580 --> 00:00:15,690
Lo voy a salir de sesión.

6
00:00:17,660 --> 00:00:23,330
Ahora voy a la tienda, voy a seleccionar el producto Camisa moderna, que es el que hemos estado probando.

7
00:00:24,170 --> 00:00:26,630
Voy a seleccionar aquí negro.

8
00:00:27,730 --> 00:00:30,520
Y la H y le agregamos al carrito de compras.

9
00:00:32,290 --> 00:00:33,130
Voy a pagar.

10
00:00:33,840 --> 00:00:34,840
Y mi sucesión?

11
00:00:35,990 --> 00:00:36,860
Vuelvo al carrito.

12
00:00:37,830 --> 00:00:39,180
Y ya me aparece el producto.

13
00:00:39,930 --> 00:00:44,580
Está bien, porque en este caso tengo el mismo producto pero con diferentes variaciones.

14
00:00:44,880 --> 00:00:48,440
Uno es color negro medium y otro es color negro large.

15
00:00:49,050 --> 00:00:51,880
Pero qué pasaría si tuviera el mismo variación?

16
00:00:51,900 --> 00:00:52,890
Debería de agruparse.

17
00:00:52,890 --> 00:00:53,340
Verdad?

18
00:00:53,850 --> 00:01:00,450
Si yo agregara un nuevo producto Camisa moderna con Negro Large, debería agregarse a este grupo y solo

19
00:01:00,450 --> 00:01:01,890
cambiar la cantidad en dos.

20
00:01:02,160 --> 00:01:03,540
Vamos a ver si esto sucede.

21
00:01:04,640 --> 00:01:06,140
Primero vamos a salir de sesión.

22
00:01:07,720 --> 00:01:08,680
Vamos a la tienda.

23
00:01:09,130 --> 00:01:10,060
Camisa moderna.

24
00:01:10,760 --> 00:01:11,770
Seleccione negro.

25
00:01:13,770 --> 00:01:16,530
Ya la habría hecho Piccard.

26
00:01:17,610 --> 00:01:17,940
Listo.

27
00:01:17,940 --> 00:01:18,770
Le hemos agregado.

28
00:01:18,780 --> 00:01:20,310
Voy a darle clic al botón Pagar.

29
00:01:21,180 --> 00:01:22,050
Y mi sucesión.

30
00:01:22,920 --> 00:01:23,770
Perfecto.

31
00:01:23,880 --> 00:01:25,230
Voy al carrito de compras.

32
00:01:26,400 --> 00:01:27,660
Y mira lo que está pasando.

33
00:01:28,720 --> 00:01:29,980
No se está agrupando.

34
00:01:29,980 --> 00:01:36,610
Lo que está sucediendo es que se está creando una nueva línea cada vez y no está agrupando el producto

35
00:01:36,610 --> 00:01:38,680
por similares variaciones.

36
00:01:39,070 --> 00:01:40,940
Sigo estando en la sección de nuestros bachilleres.

37
00:01:40,960 --> 00:01:42,310
Quiero mostrarte algo.

38
00:01:42,850 --> 00:01:44,140
Vamos a volver a tienda.

39
00:01:45,800 --> 00:01:49,820
Y quiero agregar otra vez el producto, pero ahora el color es naranja.

40
00:01:51,570 --> 00:01:53,790
Y debería agregar la línea por defecto.

41
00:01:54,150 --> 00:01:56,100
Voy a darle clic en el botón Agregar a.

42
00:01:57,510 --> 00:01:59,070
Y tampoco lo está agregando.

43
00:01:59,490 --> 00:02:02,040
Entonces, aquí tengo dos problemas a resolver.

44
00:02:02,340 --> 00:02:08,370
El primero es que no me permite agrupar los productos con similares variaciones.

45
00:02:09,060 --> 00:02:15,360
Y el segundo es que si estoy en la sesión del usuario y quiero agregar un nuevo producto con diferentes

46
00:02:15,360 --> 00:02:18,930
variaciones, tampoco lo permite agregar al carrito de compras.

47
00:02:19,830 --> 00:02:23,070
Vamos a resolver estos problemas en los siguientes minutos.

48
00:02:23,340 --> 00:02:24,500
Estamos nuevamente en auto.

49
00:02:24,510 --> 00:02:31,170
Vamos a ir a karts y al archivo buscar y y vamos a buscar la función ad cart.

50
00:02:31,470 --> 00:02:32,810
Está en la parte superior.

51
00:02:32,820 --> 00:02:33,600
Vamos a ver.

52
00:02:36,250 --> 00:02:38,800
Si aquí aparece ya la función ad card.

53
00:02:40,550 --> 00:02:47,210
Esta función es la que te permite agregar nuevos items al carrito de compras existente y si no existe

54
00:02:47,210 --> 00:02:50,390
el carrito de compras, también esta función la va a crear por ti.

55
00:02:50,930 --> 00:02:58,220
Este método ha venido trabajando a la perfección cuando el usuario no estaba logueado dentro de nuestro

56
00:02:58,220 --> 00:02:59,660
ecommerce web applications.

57
00:02:59,930 --> 00:03:03,800
El problema viene cuando ya comenzó el usuario a iniciar sesión.

58
00:03:04,490 --> 00:03:12,320
Entonces vamos a hacer lo siguiente Vamos a ubicarnos en la primera línea Product product get y esa

59
00:03:12,320 --> 00:03:15,890
línea es independiente de si está logueado o no en le web commerce.

60
00:03:16,310 --> 00:03:22,010
Voy a darle un enter por eso acá y luego aquí vamos a agregar una nueva línea.

61
00:03:22,040 --> 00:03:23,550
Voy a indicarle Current User.

62
00:03:23,570 --> 00:03:27,620
Quiero que obtenga el usuario en sesión, saber si el usuario está en sesión.

63
00:03:28,010 --> 00:03:32,360
Por eso llamo a en esta variable desde un request user.

64
00:03:34,520 --> 00:03:35,420
Lo tenemos listo.

65
00:03:35,420 --> 00:03:37,000
Y ahora voy a hacer una condición.

66
00:03:37,010 --> 00:03:39,590
Si, current user.

67
00:03:41,620 --> 00:03:44,680
El punto es autenticado y santa.

68
00:03:45,820 --> 00:03:48,910
Si está autenticado, entonces que ocurra lo siguiente.

69
00:03:49,570 --> 00:03:51,220
Pero si no está autenticado.

70
00:03:51,220 --> 00:03:51,940
Qué significa?

71
00:03:52,210 --> 00:03:55,480
Que la lógica anterior que ha estado trabajando en la perfección continúe.

72
00:03:55,600 --> 00:03:57,820
Es decir, el resto de líneas de código del método.

73
00:03:57,820 --> 00:04:00,190
Voy a seleccionarlas hasta abajo.

74
00:04:01,500 --> 00:04:03,390
Hasta el retire.

75
00:04:04,590 --> 00:04:05,010
Continúe.

76
00:04:05,100 --> 00:04:10,810
Le voy a poner un top para que pueda ubicarse dentro de la condición else.

77
00:04:11,250 --> 00:04:12,090
Perfecto.

78
00:04:12,270 --> 00:04:12,810
Ahí está.

79
00:04:13,140 --> 00:04:17,730
Entonces todo lo demás va a continuar cuando el usuario no está autenticado.

80
00:04:17,910 --> 00:04:19,230
Pero sí está autenticado.

81
00:04:19,890 --> 00:04:20,970
Aquí en este.

82
00:04:20,970 --> 00:04:21,780
En este bloque.

83
00:04:22,170 --> 00:04:23,340
Voy a poner aquí un comentario.

84
00:04:26,720 --> 00:04:30,500
Agregaremos la lógica del carrito de compras.

85
00:04:32,120 --> 00:04:32,690
Cuando.

86
00:04:35,320 --> 00:04:44,290
El usuario está autenticado cuando inicia sesión, pero realmente esta lógica para agregar nuevos items

87
00:04:44,290 --> 00:04:49,900
a un existente carrito de compras o crear un carrito de compras es muy similar a lo que está en el Else.

88
00:04:50,080 --> 00:04:55,840
La única diferencia es que tengo que agregarle ciertas condiciones sobre la sesión del usuario.

89
00:04:56,560 --> 00:04:58,260
Entonces mira lo que voy a hacer.

90
00:04:58,300 --> 00:05:02,100
Voy a copiar nuevamente todo lo que está dentro del bloque L.

91
00:05:02,500 --> 00:05:03,340
Vamos a copiarlo.

92
00:05:04,460 --> 00:05:06,010
Aquí está tu retiro en Cal.

93
00:05:07,460 --> 00:05:08,390
Lo copiamos.

94
00:05:10,800 --> 00:05:14,250
Yo ahora voy a poner mi cursor al nivel de Live.

95
00:05:14,340 --> 00:05:14,730
Está bien.

96
00:05:14,760 --> 00:05:15,420
Al nivel de Live.

97
00:05:15,450 --> 00:05:15,840
Ponlo.

98
00:05:17,110 --> 00:05:17,990
Está ahí tu cursor?

99
00:05:18,010 --> 00:05:18,700
Ahora sí.

100
00:05:18,730 --> 00:05:19,360
Pégalo.

101
00:05:20,140 --> 00:05:20,750
Perfecto.

102
00:05:20,770 --> 00:05:22,720
Tienes que tener mucho cuidado con los stops.

103
00:05:22,930 --> 00:05:29,860
Verifica que la siguiente líneas de código, por ejemplo, por producto, estén a un tap del if original

104
00:05:29,860 --> 00:05:31,690
que es correcto usar.

105
00:05:31,750 --> 00:05:32,530
Es autenticado.

106
00:05:33,900 --> 00:05:36,810
Ahora comencemos a evaluar el código del IFI.

107
00:05:37,230 --> 00:05:38,130
Es autenticado.

108
00:05:38,430 --> 00:05:40,950
Primeramente, estoy declarando una variable Product Aviation.

109
00:05:41,040 --> 00:05:42,060
Eso está correcto.

110
00:05:42,480 --> 00:05:47,880
Y luego estoy obteniendo, mediante el método Post, los valores de los variación.

111
00:05:49,500 --> 00:05:50,630
Eso también está correcto.

112
00:05:50,640 --> 00:05:51,720
No lo voy a modificar.

113
00:05:52,350 --> 00:05:58,050
A continuación, tenemos un segmento try except para poder evaluar capturar lo que es el car.

114
00:05:58,320 --> 00:06:04,590
Pero en este caso, yo ya estoy logueado, así que no necesito capturar ni guardar un nuevo car.

115
00:06:06,050 --> 00:06:06,650
Voy a por eso.

116
00:06:06,650 --> 00:06:08,240
Eliminar esa sección que se traía.

117
00:06:08,270 --> 00:06:08,590
Sep.

118
00:06:09,290 --> 00:06:14,000
Lo que continúa ahora es una condición para saber si el item existe.

119
00:06:14,320 --> 00:06:17,120
Si mi carrito de compras tiene elementos.

120
00:06:18,230 --> 00:06:24,320
Aquí la condición indica que va a buscar la existencia de este carrito basado en el producto y en el

121
00:06:24,320 --> 00:06:25,730
objeto car igual a car.

122
00:06:26,030 --> 00:06:32,810
Pero esta condición car igual a car la voy a reemplazar porque quiero que ahora busque dependiendo del

123
00:06:32,810 --> 00:06:38,540
tipo de usuario, dependiendo del usuario, así que le voy a poner user igual a que al current user,

124
00:06:38,540 --> 00:06:43,220
ese objeto que en la parte superior había obtenido desde el request user.

125
00:06:44,830 --> 00:06:50,530
Si el resultado de esto es true, si realmente hay elementos dentro de este carrito de compras, cuando

126
00:06:50,530 --> 00:06:56,920
yo filtro por el producto y el actual user recepción del usuario, entonces voy a tener que hacer esta

127
00:06:56,920 --> 00:06:58,690
condición y buscar exit.

128
00:06:59,080 --> 00:07:05,950
Entonces, ahora, si obtener obtener la lista de elementos del carrito de compras está haciendo un

129
00:07:05,950 --> 00:07:11,740
car item punto objects Paint Filter haciendo la búsqueda por product y car igual a cart.

130
00:07:11,890 --> 00:07:16,840
Pero como te repito, yo no necesito ese car igual a car, lo que necesito es que me busque los elementos

131
00:07:16,840 --> 00:07:22,180
por registrados por el usuario en sesión, por eso que le pongo user.

132
00:07:23,180 --> 00:07:24,560
Igual a Current Users.

133
00:07:26,950 --> 00:07:35,000
A continuación, estoy obteniendo todos los variaciones de este item en este bucle declarando Este es

134
00:07:35,200 --> 00:07:35,680
Arliss.

135
00:07:36,250 --> 00:07:37,480
Donde van a estar las variaciones?

136
00:07:37,870 --> 00:07:39,250
Eso va a continuar igual.

137
00:07:40,940 --> 00:07:47,690
Continuamos con la siguiente condición si es si el triatlón está dentro de la lista que encontró en

138
00:07:47,690 --> 00:07:48,830
la base de datos.

139
00:07:49,520 --> 00:07:55,190
Este primer bloque del IF es correcto, no lo voy a modificar, pero el segundo bloque, el Eels, se

140
00:07:55,190 --> 00:08:02,960
refiere al hecho de crear un nuevo item utilizando el probado que iguala el igual a uno y el objeto

141
00:08:02,960 --> 00:08:03,350
car.

142
00:08:03,650 --> 00:08:09,080
Este objeto CAR lo voy a reemplazar por el user iguala current user.

143
00:08:11,140 --> 00:08:15,280
Hemos culminado ya este LP y luego continúa otro LP.

144
00:08:15,400 --> 00:08:18,220
Pero este él proviene de la condición.

145
00:08:18,400 --> 00:08:27,010
Si el Kryten existe, si no existe el item, entonces lo que va a hacer es crear también un nuevo item

146
00:08:27,250 --> 00:08:32,140
utilizando el product, el quality n1 y el CAR igual a car.

147
00:08:32,350 --> 00:08:33,820
Este car lo voy a reemplazar.

148
00:08:34,980 --> 00:08:36,060
Vamos a colocarle aquí.

149
00:08:37,500 --> 00:08:39,510
Vamos a ponerlo acá, user.

150
00:08:40,930 --> 00:08:43,150
Igual a current user.

151
00:08:44,890 --> 00:08:46,270
Lo que continuó en la lógica.

152
00:08:46,480 --> 00:08:49,690
Para las variaciones del registro de las variaciones es correcto.

153
00:08:50,730 --> 00:08:53,730
Y finalmente hace un rato hacia el CAR.

154
00:08:54,270 --> 00:09:00,500
Vamos a borrar todos los cambios del Safe Hall y vamos a probar a la página antes de hacer las pruebas

155
00:09:00,510 --> 00:09:01,020
de la página.

156
00:09:01,050 --> 00:09:04,350
Vamos al Chango Administration a lo que ha hecho el Admin.

157
00:09:05,810 --> 00:09:07,440
Y ahora vamos a ir a karts.

158
00:09:07,460 --> 00:09:11,870
Quiero eliminar todos los karts para empezar bien esta prueba.

159
00:09:12,410 --> 00:09:17,000
Selecciono todos ahora el combo Box Wild Cars y hago clic al botón Ok, go.

160
00:09:17,900 --> 00:09:19,580
Y en la parte final, Just and sure.

161
00:09:19,580 --> 00:09:24,770
Para eliminar todos estos items, voy a items para verificar y todo está en blanco.

162
00:09:26,020 --> 00:09:26,970
Vamos a la página.

163
00:09:26,980 --> 00:09:28,040
Estoy en la sesión.

164
00:09:28,060 --> 00:09:31,150
Recuerda, si no estás en sesión, ingresa tu sesión del usuario.

165
00:09:32,330 --> 00:09:34,220
Como puedes ver, voy a refrescar nuevamente.

166
00:09:34,580 --> 00:09:35,650
Mi carrito de compras.

167
00:09:35,660 --> 00:09:37,550
Está completamente vacío.

168
00:09:38,030 --> 00:09:43,250
Vamos a hacer la prueba estando en sesión, voy a seleccionar Camisa Moderna Seleccione.

169
00:09:43,250 --> 00:09:45,770
Voy a seleccionar un rojo en la.

170
00:09:47,090 --> 00:09:48,380
Y lo agregó al carrito.

171
00:09:49,300 --> 00:09:49,430
Bien.

172
00:09:49,540 --> 00:09:51,130
Ya tengo el producto agregado.

173
00:09:51,130 --> 00:09:52,450
La cantidad es correcta.

174
00:09:53,080 --> 00:09:58,360
Voy a volver a la tienda a agregar el mismo producto con los mismos brillo rojo y large.

175
00:09:59,530 --> 00:10:02,440
Seleccionó el producto rojo.

176
00:10:03,960 --> 00:10:04,440
Larch.

177
00:10:05,410 --> 00:10:12,100
Agregar al shopping card y como puedes ver, ya se está actualizando la cantidad, porque ambos productos

178
00:10:12,100 --> 00:10:14,440
que he seleccionado tienen las mismas variaciones.

179
00:10:14,620 --> 00:10:20,350
Pero ahora probemos con otro caso el producto camisa moderna pero con diferentes variaciones.

180
00:10:21,500 --> 00:10:23,300
Vamos a tienda, selecciono el producto.

181
00:10:23,570 --> 00:10:27,680
Ahora voy a indicarle que sea naranja y la talla que sea Sort.

182
00:10:28,520 --> 00:10:36,800
Le vamos a agregar el pin cart y como puedes ver, ya se agregó el producto a al carrito de compras

183
00:10:36,890 --> 00:10:37,970
como una nueva línea.
